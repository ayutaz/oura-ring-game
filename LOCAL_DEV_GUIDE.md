# Oura Quest ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºç’°å¢ƒã‚¬ã‚¤ãƒ‰

## ğŸ³ Dockerç’°å¢ƒã§ã®é–‹ç™º

æœ¬ãƒ—ãƒ­ãƒˆã‚¿ã‚¤ãƒ—ã¯ã€Dockerç’°å¢ƒã§å®Œçµã™ã‚‹ãƒ­ãƒ¼ã‚«ãƒ«é–‹ç™ºã‚’å‰æã¨ã—ã¦ã„ã¾ã™ã€‚
Cloudflare Workersã‚„D1ã®ä»£ã‚ã‚Šã«ã€Node.js + PostgreSQLã§ä»£æ›¿å®Ÿè£…ã—ã¾ã™ã€‚

## ğŸ“‹ å‰ææ¡ä»¶

- Docker Desktop (Docker & Docker Compose)
- Git
- ãŠå¥½ã¿ã®ã‚¨ãƒ‡ã‚£ã‚¿ (VS Codeæ¨å¥¨)
- Oura Developer Accountï¼ˆå¾Œè¿°ã®æ‰‹é †ã§ä½œæˆï¼‰

## ğŸš€ ã‚¯ã‚¤ãƒƒã‚¯ã‚¹ã‚¿ãƒ¼ãƒˆ

### 1. ãƒªãƒã‚¸ãƒˆãƒªã®ã‚¯ãƒ­ãƒ¼ãƒ³
```bash
git clone [repository-url]
cd oura-game
```

### 2. ç’°å¢ƒå¤‰æ•°ã®è¨­å®š
```bash
cp .env.example .env
```

`.env`ãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç·¨é›†ã—ã€ä»¥ä¸‹ã‚’è¨­å®šï¼š
- `OURA_CLIENT_ID`: Ouraé–‹ç™ºè€…ãƒãƒ¼ã‚¿ãƒ«ã§å–å¾—
- `OURA_CLIENT_SECRET`: Ouraé–‹ç™ºè€…ãƒãƒ¼ã‚¿ãƒ«ã§å–å¾—
- ãã®ä»–ã®ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆã‚­ãƒ¼ã¯é©å½“ãªæ–‡å­—åˆ—ã§OK

### 3. åˆæœŸã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
```bash
make setup
```

### 4. é–‹ç™ºç’°å¢ƒã®èµ·å‹•
```bash
make start
```

### 5. ã‚¢ã‚¯ã‚»ã‚¹ç¢ºèª
- Web: http://localhost:3000
- API: http://localhost:8787
- pgAdmin: http://localhost:5050
  - Email: admin@example.com
  - Password: admin

## ğŸ—ï¸ ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Remix App     â”‚â”€â”€â”€â”€â–¶â”‚   Hono API      â”‚â”€â”€â”€â”€â–¶â”‚  PostgreSQL     â”‚
â”‚   (Port 3000)   â”‚     â”‚   (Port 8787)   â”‚     â”‚   (Port 5432)   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                                â”‚
         â”‚                                                â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        Oura API (External)
```

### ã‚³ãƒ³ãƒ†ãƒŠæ§‹æˆ
- **web**: Remix ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³
- **api**: Hono APIã‚µãƒ¼ãƒãƒ¼
- **db**: PostgreSQL (Cloudflare D1ã®ä»£æ›¿)
- **pgadmin**: ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ç®¡ç†UI

## ğŸ“ ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹é€ 

```
oura-game/
â”œâ”€â”€ apps/
â”‚   â”œâ”€â”€ web/              # Remix ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰
â”‚   â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ public/
â”‚   â”‚   â””â”€â”€ package.json
â”‚   â””â”€â”€ api/              # Hono ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰
â”‚       â”œâ”€â”€ src/
â”‚       â””â”€â”€ package.json
â”œâ”€â”€ database/
â”‚   â””â”€â”€ init.sql          # åˆæœŸã‚¹ã‚­ãƒ¼ãƒ
â”œâ”€â”€ docker-compose.yml
â”œâ”€â”€ Dockerfile.web
â”œâ”€â”€ Dockerfile.api
â”œâ”€â”€ Makefile
â””â”€â”€ .env
```

## ğŸ”§ é–‹ç™ºã‚³ãƒãƒ³ãƒ‰

### åŸºæœ¬æ“ä½œ
```bash
# ç’°å¢ƒèµ·å‹•
make start

# ç’°å¢ƒåœæ­¢
make stop

# ãƒ­ã‚°ç¢ºèª
make logs
make logs-web  # Webã®ã¿
make logs-api   # APIã®ã¿

# ãƒ†ã‚¹ãƒˆå®Ÿè¡Œ
make test
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ“ä½œ
```bash
# DBã‚³ãƒ³ã‚½ãƒ¼ãƒ«æ¥ç¶š
make db-console

# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿æŠ•å…¥
make db-seed

# ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³å†å®Ÿè¡Œ
make db-migrate
```

### ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°
```bash
# ç’°å¢ƒã®ã‚¯ãƒªãƒ¼ãƒ³ã‚¢ãƒƒãƒ—
make clean

# ã‚³ãƒ³ãƒ†ãƒŠã«å…¥ã£ã¦èª¿æŸ»
make web-shell
make api-shell
```

## ğŸ” Oura APIè¨­å®š

### 1. Oura Developer Accountä½œæˆ
1. https://cloud.ouraring.com ã«ã‚¢ã‚¯ã‚»ã‚¹
2. é–‹ç™ºè€…ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ä½œæˆ
3. æ–°ã—ã„ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ç™»éŒ²

### 2. ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è¨­å®š
- **Application Name**: Oura Quest Dev
- **Redirect URI**: `http://localhost:3000/auth/callback`
- **Scopes**: 
  - personal
  - daily
  - heartrate
  - workout
  - tag
  - session

### 3. èªè¨¼æƒ…å ±ã®å–å¾—
- Client ID ã¨ Client Secret ã‚’`.env`ã«ã‚³ãƒ”ãƒ¼

## ğŸ§ª ãƒ­ãƒ¼ã‚«ãƒ«ã§ã®ãƒ†ã‚¹ãƒˆæ–¹æ³•

### 1. Ouraé€£æºãªã—ã§ãƒ†ã‚¹ãƒˆ
```bash
# ãƒ†ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’æŠ•å…¥
make db-seed

# ãƒ–ãƒ©ã‚¦ã‚¶ã§ã‚¢ã‚¯ã‚»ã‚¹
# http://localhost:3000
```

### 2. ãƒ¢ãƒƒã‚¯ãƒ‡ãƒ¼ã‚¿ã§ãƒ†ã‚¹ãƒˆ
APIã«`/mock`ã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆã‚’ç”¨æ„ã—ã€å®Ÿéš›ã®Ouraãƒ‡ãƒ¼ã‚¿å½¢å¼ã§ãƒ†ã‚¹ãƒˆå¯èƒ½

### 3. å®Ÿéš›ã®Ouraãƒ‡ãƒ¼ã‚¿ã§ãƒ†ã‚¹ãƒˆ
1. Oura Ringã‚’è£…ç€
2. ã‚¢ãƒ—ãƒªã§èªè¨¼
3. å®Ÿãƒ‡ãƒ¼ã‚¿ã§å‹•ä½œç¢ºèª

## ğŸ“ é–‹ç™ºãƒ•ãƒ­ãƒ¼

### æ©Ÿèƒ½è¿½åŠ ã®æµã‚Œ
1. **ãƒ–ãƒ©ãƒ³ãƒä½œæˆ**
   ```bash
   git checkout -b feature/new-feature
   ```

2. **ã‚³ãƒ¼ãƒ‰ç·¨é›†**
   - ãƒ›ãƒƒãƒˆãƒªãƒ­ãƒ¼ãƒ‰ãŒæœ‰åŠ¹ãªã®ã§ã€ä¿å­˜ã™ã‚‹ã¨è‡ªå‹•åæ˜ 

3. **ãƒ†ã‚¹ãƒˆ**
   ```bash
   make test
   ```

4. **ã‚³ãƒŸãƒƒãƒˆ & ãƒ—ãƒƒã‚·ãƒ¥**
   ```bash
   git add .
   git commit -m "Add new feature"
   git push origin feature/new-feature
   ```

## ğŸ› ã‚ˆãã‚ã‚‹å•é¡Œã¨è§£æ±ºæ–¹æ³•

### ãƒãƒ¼ãƒˆãŒä½¿ç”¨ä¸­
```bash
# ä½¿ç”¨ä¸­ã®ãƒãƒ¼ãƒˆã‚’ç¢ºèª
lsof -i :3000
lsof -i :8787
lsof -i :5432

# ãƒ—ãƒ­ã‚»ã‚¹ã‚’çµ‚äº†ã—ã¦ã‹ã‚‰å†èµ·å‹•
make restart
```

### ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹æ¥ç¶šã‚¨ãƒ©ãƒ¼
```bash
# DBã‚³ãƒ³ãƒ†ãƒŠã®ãƒ­ã‚°ã‚’ç¢ºèª
docker-compose logs db

# DBã‚’å†èµ·å‹•
docker-compose restart db
```

### node_modulesã®å•é¡Œ
```bash
# ã‚³ãƒ³ãƒ†ãƒŠå†…ã§å†ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«
docker-compose exec web npm install
docker-compose exec api npm install
```

## ğŸš€ ãƒ—ãƒ­ãƒ€ã‚¯ã‚·ãƒ§ãƒ³ç§»è¡Œæ™‚ã®æ³¨æ„

ã“ã®ãƒ­ãƒ¼ã‚«ãƒ«ç’°å¢ƒã¯é–‹ç™ºç”¨ã§ã™ã€‚æœ¬ç•ªç’°å¢ƒã§ã¯ï¼š

1. **PostgreSQL â†’ Cloudflare D1**
   - SQLæ§‹æ–‡ã®é•ã„ã«æ³¨æ„
   - ãƒˆãƒ©ãƒ³ã‚¶ã‚¯ã‚·ãƒ§ãƒ³å‡¦ç†ã®èª¿æ•´

2. **Node.js â†’ Cloudflare Workers**
   - Workersåˆ¶é™äº‹é …ã®ç¢ºèª
   - KV/Durable Objectsã®æ´»ç”¨

3. **ç’°å¢ƒå¤‰æ•°ç®¡ç†**
   - Cloudflare Secretsã¸ã®ç§»è¡Œ
   - APIã‚­ãƒ¼ã®å®‰å…¨ãªç®¡ç†

## ğŸ“š å‚è€ƒãƒªãƒ³ã‚¯

- [Remix Documentation](https://remix.run/docs)
- [Hono Documentation](https://hono.dev)
- [Oura API Documentation](https://cloud.ouraring.com/docs)
- [Docker Documentation](https://docs.docker.com)

---

Happy Coding! ğŸ®âœ¨