# Oura Quest - TDD実装サマリー

## t-wadaスタイルTDDの実践

### 実装したテストと機能

#### 1. キャラクターシステム（Character）
**Red → Green → Refactorサイクル**
- ✅ 睡眠スコア → MP計算
- ✅ 歩数・活動量 → 攻撃力計算
- ✅ 準備度・HRV → クリティカル率計算
- ✅ 健康データ傾向 → 職業判定
- ✅ 経験値獲得 → レベルアップ

**設計の創発**
- テストを書く過程で`BASE_STATS`定数の必要性が明確に
- 職業判定ロジックの重み付けがテストを通じて調整

#### 2. 冒険システム（Adventure）
**時間帯別の冒険ロジック**
- ✅ 朝の冒険：睡眠データベース
- ✅ 昼の冒険：活動データベース  
- ✅ 夕方の冒険：総合データベース
- ✅ 報酬計算：健康スコア平均に比例
- ✅ クラスボーナス：職業による差別化

**テストが導いた設計改善**
- 各時間帯で独立したメソッドに分離
- 結果を統一的な`AdventureResult`型で返却

#### 3. フィードバックシステム（Feedback）
**時間軸でのフィードバック設計**
- ✅ 即時フィードバック（0-3秒）
- ✅ 朝のフィードバック（睡眠結果）
- ✅ 昼のフィードバック（活動進捗）
- ✅ 夕方のフィードバック（1日の総括）
- ✅ 連続記録・マイルストーン
- ✅ ネガティブイベントの緩和

**テストファーストの恩恵**
- enumによるタイプセーフな実装
- 各フィードバックの独立性を保証

## ゲーム体験の核心

### 🎯 なぜ楽しいのか

#### 1. **即座の成功体験**
```typescript
// 歩数増加 → 即座にコイン獲得
onStepsUpdate(5000, 5100) // → coin_sparkle + coin_collect音
```
- 健康行動が0.5秒以内にゲーム内報酬に変換
- 脳の報酬系を刺激する即時フィードバック

#### 2. **努力の可視化**
```typescript
// 睡眠スコア90点 → 伝説の休息演出
getMorningFeedback({ sleep: { score: 92 }}) // → legendary_rest
```
- 抽象的な健康データを具体的な物語に変換
- 「良い睡眠」→「伝説の休息で魔力全開」

#### 3. **成長の実感**
```typescript
// レベルアップ = 健康習慣の積み重ね
character.gainExperience(100) // → レベル2達成！
```
- 日々の小さな改善が確実に蓄積
- 長期的な健康改善を短期的な達成感に変換

### 📊 フィードバックループの設計

#### デイリーループ（24時間）
```
6:00  睡眠データ同期 → MP回復量決定 → 朝の冒険開始
      ↓ (6時間)
12:00 活動量チェック → 進捗表示 → モチベーション維持
      ↓ (6時間)  
18:00 1日の総括 → 報酬獲得 → 明日への準備
      ↓ (12時間)
6:00  新たな1日のサイクル
```

#### 感情曲線の管理
```typescript
// ポジティブピーク
onRareItemDrop({ rarity: 'legendary', dropRate: 0.01 })
// → intensity: 'maximum', screenEffect: 'full_screen_flash'

// ネガティブ緩和
handleNegativeEvent({ type: 'sleep_penalty' })
// → compensation: 'recovery_spring', badge: 'なまけ者の日'
```

### 🔄 習慣形成のメカニズム

#### 1. **トリガー（Cue）**
- プッシュ通知：「冒険の準備ができました！」
- 時間帯別の自動イベント

#### 2. **ルーティン（Routine）**
- アプリを開く → データ同期 → 成果確認
- 簡潔な体験（2-5分で完結）

#### 3. **報酬（Reward）**
- 即時：コイン、経験値、アイテム
- 中期：レベルアップ、職業進化
- 長期：ストーリー進行、限定称号

#### 4. **投資（Investment）**
- キャラクターへの愛着
- 積み上げた記録への執着
- コレクション要素

## 技術的な学び

### TDDがもたらした価値
1. **設計の明確化**: テストを書く過程で必要なインターフェースが明確に
2. **リファクタリングの安心感**: テストがセーフティネットとして機能
3. **ドキュメントとしてのテスト**: 仕様が実行可能な形で記述

### 次のステップ
1. 統合テストの追加
2. E2Eテストによるユーザージャーニーの検証
3. パフォーマンステストの実装
4. モックを使用したOura API統合テスト

## まとめ

TDDアプローチにより、ゲームの核となる3つのシステム（キャラクター、冒険、フィードバック）を堅牢に実装できました。

特に重要なのは、**健康データを楽しい体験に変換する**というコアバリューが、テストを通じて明確に表現されていることです。

各テストケースが、実際のプレイヤー体験の一場面を表現しており、これにより開発チーム全体でゲーム体験の共通理解を持つことができます。